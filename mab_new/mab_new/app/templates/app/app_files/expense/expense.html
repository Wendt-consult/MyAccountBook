{% extends 'app/base/base.html' %}
{% load static %}

{% load common_filters %}
{% load pagination %}

{% block content %}

<div class="row custom-row" style="padding:10px; background: linear-gradient(60deg,#f5700c,#ff9800);">
    <ul style="list-style:none; margin:0px; color:#FFFFFF; padding:0px;">             
        <li class="nav-item" style="float:left;padding:0px 10px;">
            <a href="{% url 'view_expenses' %}" style="color:#FFFFFF; text-decoration:none; font-size: 20px;" title="View Expenses As List">
                <i class="material-icons">list</i>
            </a>
        </li>
        <li class="nav-item" style="float:left;padding:0px 10px;">
            <a href="{% url 'add_expense' %}" style="color:#FFFFFF; text-decoration:none; font-size: 20px;" title="Add Expense">
                <i class="material-icons">add_to_queue</i>
            </a>
        </li>            
    </ul>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header card-header-primary">
                <div class="row">
                    <div class="col">
                        <h4>View Expense</h4>
                    </div>                                
                </div>
            </div>
            <div class="card-body">
                
                <div class="table">
                    <input type="hidden" id="print_expense" value="{{ expense_id }}">
                    <a href="" target="_blank" id="link"><span style="display: none;">click</span></a>
                    <table class="table-bordered" width="100%" cellspacing="0">
                        <thead  style="background-color: #EEEEEE; color:#000000; font-size:11px">
                            <th class="text-center">Expense Voucher</th>
                            <th class="text-center">Expense Date</th>
                            <th class="text-center">Vendor</th> 
                            <th class="text-center">Payment Date</th>
                            <th class="text-center">Payment Method</th>
                            <th class="text-center">Total Amount</th>
                            <th class="text-center">Action</th>                
                        </thead>
                        <tbody>
                            {% for expense in all_expense %}
                                <tr>
                                    <td class="text-center">{{ expense.exp_number }}</td>
                                    <td class="text-center">{{ expense.exp_date|date:"d/m/Y" }}</td>
                                    <td class="text-center">{{ expense.vendor }}</td>
                                    <td class="text-center">{% if expense.payment_date %} {{ expense.payment_date|date:"d/m/Y" }} {% else %} - {% endif %}</td>
                                    <td class="text-center">{% if expense.payment_method %} {{ expense.payment_method }} {% else %} - {% endif %}</td>
                                    <td class="text-center">{{ expense.exp_total }}</td>
                                    <td class="text-center">
                                        <button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >Action</button>
                                        
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                            <a class="dropdown-item" title="Edit Expense" href="{% url 'edit_expense' expense.id %}" class="btn btn-primary btn-sm" style="padding:5px 5px;">
                                                Edit
                                            </a>
                                            <button class="dropdown-item delete_expense" title="Delete Expense" type="button" id="{{ expense.id }}" class="btn btn-primary btn-sm" style="padding:5px 5px;">
                                                Delete
                                            </button>
                                            <a class="dropdown-item" title="Print Expense" href="{% url 'generate_pdf' expense.id %}" class="btn btn-primary btn-sm" target="_blank" style="padding:5px 5px;">
                                                Print
                                            </a>
                                            <a class="dropdown-item" title="Clone Expense" href="{% url 'clone_expense' expense.id 'clone' %}" class="btn btn-primary btn-sm" style="padding:5px 5px;">
                                                Make a Copy
                                            </a>
                                        </div> 
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
    <script type="text/javascript">
        $('.delete_expense').on('click', function(){
            if(confirm('You want to delete this expense?')){
                var expense_id = $(this).attr('id');
                url = "{% url 'delete_expense' 0 %}"
                window.location.href = url.replace('0',expense_id);
            }
        });

        if ($("#print_expense").val()){
            str = "{%url 'generate_pdf' 0 %}"
            url = str.replace("0", $("#print_expense").val());
            $('#link').attr('href', url);
            $('#link').find("span").trigger("click");
        }
    </script>
{% endblock %}
