{% load common_components %}
{% load common_filters %}
{% loader_component %}

<style>
    select.form-control{padding:0px 10px;}
    select.form-control option{color : #000000; }
        #gst_reg.form-control option{color : #000000; }
        #gst_reg{
            padding-top: 0%;
        }
    </style>



<div class="row">
    <div class="col-lg-12" style="padding:0px">
        <div class="card">
            <div class="card-body"> 
                <div class="container" style="margin-top:11px;">
                    <form action="" method="get">
                    <div class="row" >
                        <div class="col-1">
                            <label style="font-size:90%">Account</label>
                        </div>
                        <div class="col-2">
                            <select required name="account_type" class="form-control" style="margin-left:-25px;">
                                <option value="" selected >--Select--</option>
                                <optgroup label="Input GST">
                                    <option value="0" {% if account_type == '0'%} selected {% endif %}>All input GST</option>
                                    <option value="0-sgst" {% if account_type == '0-sgst'%} selected {% endif %}>SGST</option>
                                    <option value="0-cgst"{% if account_type == '0-cgst'%} selected {% endif %}>CGST</option>
                                    <option value="0-igst" {% if account_type == '0-igst'%} selected {% endif %}>IGST</option>
                                </optgroup>
                                <optgroup label="Output GST">
                                    <option value="1" {% if account_type == '1'%} selected {% endif %}>All Output GST</option>
                                    <option value="1-sgst" {% if account_type == '1-sgst'%} selected {% endif %}>SGST</option>
                                    <option value="1-cgst" {% if account_type == '1-cgst'%} selected {% endif %}>CGT</option>
                                    <option value="1-igst" {% if account_type == '1-igst'%} selected {% endif %}>IGST</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-2 text-center">
                            <label style="font-size:90%">Period</label>
                        </div>
                        <div class="col-1" style="margin-left:-50px;">
                            <select required name="time_period" onchange="show_hide_custom_dates($(this))" class="form-control" style="width:69px;">
                                <option value="0" {% if time_period == '0' %} selected {% endif %}>Custom</option>
                                <option value="1" {% if time_period == '1' %} selected {% endif %}>Monthly</option>
                                <option value="2" {% if time_period == '2' %} selected {% endif %}>Quaterly</option>
                                <option value="3" {% if time_period == '3' %} selected {% endif %}>Half Yearly</option>
                                <option value="4" {% if time_period == '4' %} selected {% endif %}>Yearly</option>                                 
                            </select>
                        </div>
                        <div class="custom_dates_show_year col-1" style="display:none">
                            <label style="font-size:90%">Year</label>
                        </div>
                        <div class="custom_dates_show_year col-1 hide" style="display:none">
                            <select id = "year"name="year" class="form-control">
                                <option value=""></option>
                                {% for year in year_list %}
                                <option value="{{year}}" {% if year|safe == year_t %} selected {% endif %}>{{year}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="custom_dates_show_month col-1" style="display:none">
                            <label style="font-size:90%">Month</label>
                        </div>
                        <div class="custom_dates_show_month col-1 hide" style="display:none">
                            <select id = "month"name="month" class="form-control" >
                                <option value=""></option>
                                <option value="1" {% if month_t == '1' %} selected {% endif %}>Jan</option>
                                <option value="2" {% if month_t == '2' %} selected {% endif %}>Feb</option>
                                <option value="3" {% if month_t == '3' %} selected {% endif %}>Mar</option>
                                <option value="4" {% if month_t == '4' %} selected {% endif %}>Apr</option>
                                <option value="5" {% if month_t == '5' %} selected {% endif %}>May</option>
                                <option value="6" {% if month_t == '6' %} selected {% endif %}>Jun</option>
                                <option value="7" {% if month_t == '7' %} selected {% endif %}>Jul</option>
                                <option value="8" {% if month_t == '8' %} selected {% endif %}>Aug</option>
                                <option value="9" {% if month_t == '9' %} selected {% endif %}>Sep</option>
                                <option value="10" {% if month_t == '10' %} selected {% endif %}>Oct</option>
                                <option value="11" {% if month_t == '11' %} selected {% endif %}>Nov</option>
                                <option value="12" {% if month_t == '12' %} selected {% endif %}>Dec</option>
                            </select>
                        </div>
                        <div class="custom_dates_show_month_q col-1" style="display:none">
                            <label style="font-size:90%">Month</label>
                        </div>
                        <div class="custom_dates_show_month_q col-1 hide" style="display:none">
                            <select id="q_month" name="q_month" class="form-control">
                                <option value=""></option>
                                <option value="1">Apr-Jun</option>
                                <option value="2">Jul-Sep</option>
                                <option value="3">Oct-Dec</option>
                                <option value="0">Jan-Mar</option>
                            </select>
                        </div>
                        <div class="custom_dates_show_month_h col-1" style="display:none">
                            <label style="font-size:90%">Month</label>
                        </div>
                        <div class="custom_dates_show_month_h col-1 hide" style="display:none">
                            <select id="h_month" name="h_month" class="form-control">
                                <option value=""></option>
                                <option value="1">Apr-Sep</option>
                                <option value="2">Oct-Mar</option>
                            </select>
                        </div>
                        <div class="col-1 custom_dates_show">
                            <label style="font-size:90%">Start Date</label>
                        </div>
                        <div class="col-2 custom_dates_show" >
                            <input id="start_date" type="date" name="start_date" value="{{start_date}}" class="form-control report_dates">
                        </div>
                        <div class="col-1 custom_dates_show">
                            <label style="font-size:90%">End Date</label>
                        </div>
                        <div class="col-2 custom_dates_show" >
                            <input id="end_date" type="date" name="end_date" value="{{end_date}}" class="form-control report_dates">
                        </div>
                        <div class="col-2" style="margin-left:380px;">
                            <input type="submit" name="save_btn" class="btn btn-sm btn-primary" value="Submit">
                        </div>
                    </div>  
                    </form> 
                </div>
            </div>
        </div>
    </div>
</div>

{% if gst_reports_show %}


<div class="row">
    <div class="col-lg-12" style="padding:0px">
        <div class="card">
            <form action="{% url 'get_reports_pdf' %}" method="post">
                <div class="card-body"> 
                    {% csrf_token %}
                    <textarea name="html_content" id="html_content" style="display:none;"></textarea>
                    <input type="submit" name="pdf_btn" class="btn  pull-right" value="GET PDF" style="background-color:#c3c3c3;color:black;">

                    <button type="button" class="btn btn-primary pull-right" data-toggle="modal" data-target="#send_mail">
                        Mail Report
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>    

<div class="row">
    <div class="col-lg-12" style="padding:0px">
        <div class="card">
            <div class="card-body"> 
                <table class="table-bordered table-hover table-striped" style="border:1px solid white;width: 100%;">
                    <tr style="background: #c3c3c3;border:1px solid #888;">
                        <th style="border:1px solid #888;color:black;font-size:11px;">Sl.No</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;width: 9%;">Date</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;width: 13%;">Particulars</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;width: 15%;">Voucher type</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;width: 15%;">Voucher number</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;width: 17%;">Debit</th>
                        <th style="border:1px solid #888;color:black;font-size:11px;">Credit</th>
                    </tr>

                    {% for row in gst_reports %}
                    <tr>
                        <td style="border:1px solid #888;color:black;font-weight:normal">{{forloop.counter}}</td>
                        <td style="border:1px solid #888;color:black;font-weight:normal">{{row.created_on|date:'d M,Y'}}</td>
                        <td style="border:1px solid #888;color:black;font-weight:normal">
                            {% if row.is_invoice %} 
                                {{row.invoice.invoice_customer}}                         
                            {% endif %}

                            {% if row.is_creditnote %} 
                                {{row.creditnote.contact_name}}                         
                            {% endif %}

                            {% if row.is_purchase_order %} 
                                {{row.purchase_order.vendor}}                         
                            {% endif %}

                            {% if row.is_expense %} 
                                {{row.expense.exp_number}}                         
                            {% endif %}
                        </td>
                        <td style="border:1px solid #888;color:black;font-weight:normal">
                            {% if row.is_invoice %} 
                                   INVOICE                    
                            {% endif %}

                            {% if row.is_creditnote %} 
                                CREDIT NOTE                        
                            {% endif %}

                            {% if row.is_purchase_order %} 
                                PURCHASE ORDER                       
                            {% endif %}

                            {% if row.is_expense %} 
                                EXPENSE                       
                            {% endif %}
                        </td>
                        <td style="border:1px solid #888;color:black;font-weight:normal">
                            {% if row.is_invoice %} 
                                {{row.invoice.invoice_number}}                         
                            {% endif %}

                            {% if row.is_creditnote %} 
                                {{row.creditnote.credit_number}}                         
                            {% endif %}

                            {% if row.is_purchase_order %} 
                                {{row.purchase_order.purchase_order_number}}                         
                            {% endif %}

                            {% if row.is_expense %} 
                                {{row.expense.exp_number}}                         
                            {% endif %}

                        </td>                        
                        <td style="border:1px solid #888;color:black;font-weight:normal">
                            {% if row.input_tab %}                                 
                                {% if g_type == 'cgst' %} {% ifnotequal row.cgst_amount "" %}&#8377; {% endifnotequal %} {{row.cgst_amount|floatformat:2}} 
                                {% elif g_type == 'sgst' %} {% ifnotequal row.sgst_amount "" %}&#8377; {% endifnotequal %} {{row.sgst_amount|floatformat:2}} 
                                {% elif g_type == 'igst' %} {% ifnotequal row.igst_amount "" %}&#8377; {% endifnotequal %} {{row.igst_amount|floatformat:2}} 
                                {% else %} 
                                    {% ifnotequal row.total_tax "" %}&#8377; {% endifnotequal %} {{row.total_tax|floatformat:2}}                                    
                                {% endif %}
                            {% endif%}
                         </td>
                         <td style="border:1px solid #888;color:black;font-weight:normal">
                            {% if not row.input_tab %}  
                                {% if g_type == 'cgst' %} {% ifnotequal row.cgst_amount "" %}&#8377; {% endifnotequal %}{{row.cgst_amount|floatformat:2}} 
                                {% elif g_type == 'sgst' %} {% ifnotequal row.sgst_amount "" %}&#8377; {% endifnotequal %} {{row.sgst_amount|floatformat:2}} 
                                {% elif g_type == 'igst' %} {% ifnotequal row.igst_amount "" %}&#8377; {% endifnotequal %} {{row.igst_amount|floatformat:2}} 
                                {% else %}
                                {% ifnotequal row.total_tax "" %}&#8377; {% endifnotequal %} {{row.total_tax|floatformat:2}}                                    
                                {% endif %}
                            {% endif%}
                        </td>
                    </tr>					
                    {% endfor %}
                    <tr style="border:1px solid #888;">
                        <td colspan="5" style="border:1px solid #888;color:black;font-weight:normal"><center>By Closing Balance</center></td>
                        <td colspan="2" class="text-center" style="border:1px solid #888;color:black;font-weight:normal">
                            
                            {% if not total_idt%}  
                                CR {{row.input_tab|safe}}
                            {% else %}
                                DR
                            {% endif %}
                            &nbsp;&#8377; 
                            {{main_tax}}
                        </td>
					</tr>
                </table>
            </div>
        </div>
    </div>
</div>


<div id="table_content" style="display:none"> 
    <table class="table-bordered table-hover table-striped" style="border:1px solid white;width: 100%;">
        <tr style="background: #c3c3c3;border:1px solid #888;">
            <th style="border:1px solid #888;color:black;font-size:11px; padding:5px 5px;">Sl.No</th>
            <th style="border:1px solid #888;color:black;font-size:11px;width: 9%; padding:5px 5px;">Date</th>
            <th style="border:1px solid #888;color:black;font-size:11px;width: 13%; padding:5px 5px;">Particulars</th>
            <th style="border:1px solid #888;color:black;font-size:11px;width: 15%; padding:5px 5px;">Voucher type</th>
            <th style="border:1px solid #888;color:black;font-size:11px;width: 15%; padding:5px 5px;">Voucher number</th>
            <th style="border:1px solid #888;color:black;font-size:11px;width: 17%; padding:5px 5px;">Debit</th>
            <th style="border:1px solid #888;color:black;font-size:11px; padding:5px 5px;">Credit</th>
        </tr>

        {% for row in gst_reports %}
        <tr>
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">{{forloop.counter}}</td>
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">{{row.created_on|date:'d M,Y'}}</td>
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                {% if row.is_invoice %} 
                    {{row.invoice.invoice_customer}}                         
                {% endif %}

                {% if row.is_creditnote %} 
                    {{row.creditnote.contact_name}}                         
                {% endif %}

                {% if row.is_purchase_order %} 
                    {{row.purchase_order.vendor}}                         
                {% endif %}

                {% if row.is_expense %} 
                    {{row.expense.exp_number}}                         
                {% endif %}
            </td>
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                {% if row.is_invoice %} 
                       INVOICE                    
                {% endif %}

                {% if row.is_creditnote %} 
                    CREDIT NOTE                        
                {% endif %}

                {% if row.is_purchase_order %} 
                    PURCHASE ORDER                       
                {% endif %}

                {% if row.is_expense %} 
                    EXPENSE                       
                {% endif %}
            </td>
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                {% if row.is_invoice %} 
                    {{row.invoice.invoice_number}}                         
                {% endif %}

                {% if row.is_creditnote %} 
                    {{row.creditnote.credit_number}}                         
                {% endif %}

                {% if row.is_purchase_order %} 
                    {{row.purchase_order.purchase_order_number}}                         
                {% endif %}

                {% if row.is_expense %} 
                    {{row.expense.exp_number}}                         
                {% endif %}

            </td>                        
            <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                {% if row.input_tab %}                                 
                    {% if g_type == 'cgst' %} {% ifnotequal row.cgst_amount "" %}Rs. {% endifnotequal %} {{row.cgst_amount|floatformat:2}} 
                    {% elif g_type == 'sgst' %} {% ifnotequal row.sgst_amount "" %}Rs. {% endifnotequal %} {{row.sgst_amount|floatformat:2}} 
                    {% elif g_type == 'igst' %} {% ifnotequal row.igst_amount "" %}Rs. {% endifnotequal %} {{row.igst_amount|floatformat:2}} 
                    {% else %} 
                        {% ifnotequal row.total_tax "" %}Rs. {% endifnotequal %} {{row.total_tax|floatformat:2}}                                    
                    {% endif %}
                {% endif%}
             </td>
             <td style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                {% if not row.input_tab %}  
                    {% if g_type == 'cgst' %} {% ifnotequal row.cgst_amount "" %}Rs. {% endifnotequal %}{{row.cgst_amount|floatformat:2}} 
                    {% elif g_type == 'sgst' %} {% ifnotequal row.sgst_amount "" %}Rs. {% endifnotequal %} {{row.sgst_amount|floatformat:2}} 
                    {% elif g_type == 'igst' %} {% ifnotequal row.igst_amount "" %}Rs. {% endifnotequal %} {{row.igst_amount|floatformat:2}} 
                    {% else %}
                    {% ifnotequal row.total_tax "" %}Rs. {% endifnotequal %} {{row.total_tax|floatformat:2}}                                    
                    {% endif %}
                {% endif%}
            </td>
        </tr>					
        {% endfor %}
        <tr style="border:1px solid #888;">
            <td colspan="5" style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                <center>By Closing Balance</center>
            </td>
            <td colspan="2" class="text-center" style="border:1px solid #888;color:black;font-weight:normal; padding:10px 5px; line-height:12px;">
                
                {% if not total_idt%}  
                    CR {{row.input_tab|safe}}
                {% else %}
                    DR
                {% endif %}
                &nbsp;Rs.
                {{main_tax}}
            </td>
        </tr>
    </table>
</div>

<div class="modal fade" id="send_mail" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="background-color:#4682B4">
            <form method="post" style="margin:0px" action="{% url 'send_reports_email' %}">
                {% csrf_token %}
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" style="color:#000000; font-weight:bold;">Send Report Via Email</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input class="form-control" type="email" value="{{org_email}}" name="email_address"> 
                        <input type="hidden" value="{{filename}}" name="file_name" readonly> 
                    </div>
                </div> 
                <div class="modal-footer">
                    <button class="btn btn-sm  save_button" style="background-color:#598ebb">Send Email</button>
                    <button class="btn btn-sm " type="reset" data-dismiss="modal" aria-label="Close" style="background-color:#c3c3c3;">Cancel</button>
                </div>
                </div>
            </form>
        </div>
    </div>
</div>




{% endif %}

<script>

var start_date = {% if start_date != "" %} true {% else %} false {% endif %};
var end_date = {% if end_date != "" %} true {% else %} false {% endif %};
var account_type = {% if account_type %} true {% else %} false {% endif %};
var time_period = {% if time_period %} true {% else %} false {% endif %};
var year_t = {% if year_t %} true {% else %} false {% endif %};
var month_t = {% if month_t %} true {% else %} false {% endif %};
var month_tq = {% if month_tq %} true {% else %} false {% endif %};
var month_th = {% if month_th %} true {% else %} false {% endif %};

console.log(start_date, end_date, account_type, time_period, year_t, month_t,month_tq, month_th )


</script>