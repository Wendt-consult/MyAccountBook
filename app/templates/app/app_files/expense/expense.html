{% extends 'app/base/base.html' %}
{% load static %}

{% load common_filters %}
{% load pagination %}

{% block content %}
<style>
/* loader */
.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  margin-left: 42%;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.icons{
    cursor: default;
}
.icons:hover{
color: white!important;
}

/* draggable targets */
[data-draggable="target"]
{
    float:left;
    list-style-type:none;
    
    width:48%;
    height:14.5em;
    overflow-y:auto;
    
    margin:0 0.5em 0.5em 0;
    padding:0.5em;
    
    border:2px solid #888;
    border-radius:0.2em;
    
    background: #c3c3c3;
    color: black;
}

/* draggable items */
[data-draggable="item"]
{
    display:block;
    list-style-type:none;
    
    margin:0 0 2px 0;
    padding:0.2em 0.4em;
    
    border-radius:0.2em;
    
    line-height:1.3;
}
#expense_hover:hover{
    color: #598ebb!important;
}
thead th{
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    z-index: 2;
    background-color:#c3c3c3;
    }
@media screen and (max-width: 1000px) and (min-width: 480px) {
  #expense_view_length {
   margin-left:71%;
  }
}
.previous{
    padding:0px!important;
} 
.next{
    padding:0px!important;
}
#journal_entry_view_previous{
    margin-right: 25px;
}
</style>
<div class="row custom-row" style="padding:10px; background: linear-gradient(60deg,#f5700c,#ff9800);">

    <div class="col-md-2" style = "margin-right: inherit;" >
        <b>All Expense</b>
    </div>
<!--    <ul style="list-style:none; margin:0px; color:#FFFFFF; padding:0px;">-->
<!--        <li class="nav-item" style="float:left;padding:0px 10px;">-->
<!--            <a href="{% url 'view_expenses' %}" style="color:#FFFFFF; text-decoration:none; font-size: 20px;" title="View Expenses As List">-->
<!--                <i class="material-icons">list</i>-->
<!--            </a>-->
<!--        </li>-->
<!--        <li class="nav-item" style="float:left;padding:0px 10px;">-->
<!--            <a href="{% url 'add_expense' %}" style="color:#FFFFFF; text-decoration:none; font-size: 20px;" title="Add Expense">-->
<!--                <i class="material-icons">add_to_queue</i>-->
<!--            </a>-->
<!--        </li>-->
<!--    </ul>-->

    <div class="col-md-5">                   
        <!-- <a href="{% url 'add_invoice' 0 'NA' %}" class="btn1">Add</a> -->
    </div>
    
    <!-- <div class="col-md-5">                
        <a href="{% url 'contacts' 0 %}" class="btn1">Add</a>
        <a href="{% url 'contacts-upload' 'views' %}" class="btn2">Import</a>
    </div> -->

    <div class="col-md-3" >                   
        <input type="search" name="search" id="con_search" placeholder="Search" class="form-control">
    </div>

    <div class="col-md-2 rect">
        <div class="row">
            <!-- <div class="col-md-1 rect2"> 
                <form action="{% url 'contacts' 2 %}" method="get">
                    <div class="dropdown">
                    
                        <button class="btn btn-success dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"data-display="static" aria-haspopup="true" aria-expanded="false" style="float: right;padding: 7px 14px 7px 14px;">
                            <i class="material-icons">filter_list</i> </div>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
    
                        
                            <!-- filter CustomerType 
                            <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                <input class="form-check-input" type="checkbox" data-toggle="collapse" href="#Customer" name="customer_type_check" style="width: 111%;margin-left: -47%;">
                                <span class="form-check-sign">
                                    <span class="check md" style="margin-left: 22px;color: black;">Customer Type</span>
                                </span>
                            </label>
                            <hr style="margin-top: 0px;margin-bottom: -1px">
    
                            <div class="collapse" id="Customer" >
                                <div>
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox"  value="1" name="customer_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Customer</span>
                                        </span>
                                    </label>
                                    
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="2" name="customer_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Vendor</span>
                                        </span>
                                    </label>
                                   
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="3" name="customer_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Employee</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            <!-- filter OrganizationType 
                            <hr style="margin-top: 0px;margin-bottom: -1px">

                            <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                <input class="form-check-input" type="checkbox" data-toggle="collapse" href="#OrganizationType" role="button" aria-expanded="false" aria-controls="OrganizationType" name="organization_type_check" style="width: 111%;margin-left: -47%;">
                                <span class="form-check-sign">
                                    <span class="check md" style="margin-left: 22px;color: black;">Organisation Type</span>
                                </span>
                            </label>

                            <hr style="margin-top: 0px;margin-bottom: -1px">
    
                            <div class="collapse"  id="OrganizationType">
                                <div>
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="1" name="org_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Individual</span>
                                        </span>
                                    </label>
                                    
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="2" name="org_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Proprietorship</span>
                                        </span>
                                    </label>

                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="4" name="org_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Partnership</span>
                                        </span>
                                    </label>
    
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="5" name="org_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Trust</span>
                                        </span>
                                    </label>
                                    
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="6" name="org_type[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Gvt. Organisation</span>
                                        </span>
                                    </label>

                                </div>
                            </div>
                            <!-- filter Active/Inactive  
                            <hr style="margin-top: 0px;margin-bottom: -1px">

                            <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                <input class="form-check-input" type="checkbox" data-toggle="collapse" href="#status" role="button" aria-expanded="false" aria-controls="status" name="status_check" style="width: 111%;margin-left: -47%;">
                                <span class="form-check-sign">
                                    <span class="check md" style="margin-left: 22px;color: black;">Status</span>
                                </span>
                            </label>
                            
                            <hr style="margin-top: 0px;margin-bottom: -1px">
    
                            <div class="collapse" id="status">
                                <div>
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="1" name="is_active[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Active</span>
                                        </span>
                                    </label>
    
                                    <label class="form-check-label" style="margin-bottom: 3px;width: 100%;">
                                        <input class="form-check-input" type="checkbox" value="0" name="is_active[]" style="width: 111%;margin-left: -38%;">
                                        <span class="form-check-sign">
                                            <span class="check" style="margin-left: 41px;color: black;">Inactive</span>
                                        </span>
                                    </label>
    
                                </div>
                            </div> 
                            <hr style="margin-top: 0px;margin-bottom: -1px"> 
                        
                            <button type="submit" class="btn btn-success btn-xs" style="float: right;margin-right: 9px;padding: 3px 11px 2px 11px;">OK</button> 
                        </div>
                    
                    </div>
                </form> -->
                
            <div class="col-md-1 rect1">
                <span title="Custom View" class="material-icons icons" data-toggle="modal" data-target="#CustomizeViewModel" style="margin-top: 13%;color: rgba(190, 186, 186, 0.781);">settings</span>
            </div>
            
        </div>

    </div>

</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <!-- <div class="card-header card-header-primary">
                <div class="row" >
                    <div class="col">
                        <h4>View Expense</h4>
                    </div> 
                    <div class="col-1">
                        <span class="material-icons icons" data-toggle="modal" data-target="#CustomizeViewModel" style="margin-top: 4%;color: rgba(190, 186, 186, 0.781);">settings</span>                           
                    </div>                               
                </div>
            </div> -->
            
            <div class="card-body">
                <div class="loader" style="display: none;"></div>
                <div class="table" id="customize_table">
                    <input type="hidden" id="print_expense" value="{{ expense_id }}">
                    <a href="" target="_blank" id="link"><span style="display: none;">click</span></a>
                    <table class="table-bordered" width="100%" cellspacing="0" id="expense_view">
                        <thead  style="background-color: #EEEEEE; color:#000000; font-size:11px">
                            {% if customize.expense_vocher != 0 %}
                            <th class="text-center customize_vocher">Expense Voucher</th>
                            {% endif %}
                            {% if customize.expense_vendor != 0 %}
                            <th class="text-center customize_vendor">Vendor</th> 
                            {% endif %}
                            {% if customize.expense_date != 0 %}
                            <th class="text-center customize_date">Expense Date</th>
                            {% endif %}
                            {% if customize.expense_payment != 0 %}
                            <th class="text-center customize_payment">Due Date</th>
                            {% endif %}
                            {% if customize.expense_method != 0 %}
                            <th class="text-center customize_method">Status</th>
                            {% endif %}
                            {% if customize.expense_amount != 0 %}
                            <th class="text-center customize_amount">Total Amount</th>
                            {% endif %}
                            {% if customize.expense_amount != 0 %}
                            <th class="text-center customize_amount">Balance Due</th>
                            {% endif %}
                            <th class="text-center">Action</th>                
                        </thead>
                        <tbody>
                            {% for expense in all_expense %}
                                <tr>
                                    {% if customize.expense_vocher != 0 %}
                                    <td class="text-center customize_vocher">{{ expense.exp_number }}</td>
                                    {% endif %}
                                    {% if customize.expense_vendor != 0 %}
                                    <td class="text-center customize_vendor">
                                        <a class="vendor_name" title="{{expense.vendor}}" id="expense_hover" href="{% url 'edit_expense' expense.id %}" style="color: #8b92a9;text-decoration: underline;">
                                            {{ expense.vendor |truncatechars:20 |title}}
                                        </a>
                                    </td>
                                    {% endif %}
                                    {% if customize.expense_date != 0 %}
                                    <td class="text-center customize_date">{{ expense.exp_date|date:"d/m/Y" }}</td>
                                    {% endif %}
                                    {% if customize.expense_payment != 0 %}
                                    <td class="text-center customize_payment">{{ expense.payment_date|date:"d/m/Y" }}</td>
                                    {% endif %}
                                    {% if customize.expense_method != 0 %}
                                    <td class="text-center customize_method">
                                        {% if expense.status == 1 %}
                                            {{ expense.get_status_display }} {{expense.expense_date_count}} days
                                        {% else %}
                                            {{ expense.get_status_display }}
                                        {% endif %}
                                    </td>
                                    {% endif %}
                                    {% if customize.expense_amount != 0 %}
                                    <td class="text-center customize_amount">{{ expense.exp_total }}</td>
                                    {% endif %}
                                    {% if customize.expense_amount != 0 %}
                                    <td class="text-center customize_amount">{{ expense.total_balance }}</td>
                                    {% endif %}
                                    <td class="text-center">
                                        <button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color:black;">Action</button>
                                        
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                            {% if expense.status != 3 and expense.status != 1 and expense.status != 4 %}
                                            <a class="dropdown-item" title="Edit Expense" href="{% url 'edit_expense' expense.id %}" class="btn btn-primary btn-sm" style="padding:5px 5px;">
                                                Edit
                                            </a>
                                            {% endif %}
                                            {% if expense.status != 3 and expense.status != 2 %}
                                                <a class="dropdown-item" title="Make Payment" data-toggle="modal" data-target="#expensePaymentModel-{{expense.id}}" style="padding: 5px 5px;cursor: pointer;">
                                                    Make Payment
                                                </a> 
                                            {% endif %}
                                            <button class="dropdown-item delete_expense" title="Delete Expense" type="button" id="{{ expense.id }}" class="btn btn-primary btn-sm" style="padding:5px 5px;outline:none;">
                                                Delete
                                            </button>
                                            <a class="dropdown-item" title="Print Expense" href="{% url 'generate_pdf' expense.id %}" class="btn btn-primary btn-sm" target="_blank" style="padding:5px 5px;">
                                                Print
                                            </a>
                                            <a class="dropdown-item" title="Clone Expense" href="{% url 'clone_expense' expense.id 'clone' %}" class="btn btn-primary btn-sm" style="padding:5px 5px;">
                                                Make a Copy
                                            </a>
                                        </div> 
                                        <!-- for make payment -->
                                <div class="modal " tabindex="-1" role="dialog" id="expensePaymentModel-{{expense.id}}" style="border-top: none;top:100px;">
                                    <div class="modal-dialog" role="document" style="border-top: none;">
                                        <div class="modal-content" style="background-color:#202940;width: 143%;">
                                            <form method="post" action="{% url 'make_payment' 'expense' %}" style="margin:0px" enctype="multipart/form-data" id="makePayment-{{expense.id}}">
                                                <div class="modal-header bg-warning">
                                                    <h5 class="modal-title" style="color:#000000; font-weight:bold;">Make Payment</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body" style="border-top: none;position: bottom;">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="entry_id" value="{{expense.id}}">
                                                    <input type="hidden" name="venodr_id" value="{{expense.vendor.id}}">
                                                    <input type="hidden" name="entry_balance" id="entry_balance-{{expense.id}}" value="{{expense.total_balance}}">
                                                    <div class="container">
                                                        <div class="row">
                                                            <!-- left -->
                                                            <div class="col" style="padding-left: 0px;">
                                                                <table class="table-responsive" >
                                                                    <tbody style=" width: 100%; display: inline-table;">
                                                                        <tr style="float: left;background-color: aliceblue;">
                                                                            <td style="border:0px; vertical-align: bottom;">
                                                                                Payment Amount
                                                                            </td>
                                                                            <td style="border:0px;">
                                                                                <input class="form-control" type="text"{% if expense.total_balance != none %} value="{{expense.total_balance}}" {% else %} value="0.00" {% endif %} name="pay_amount" id="pay_amount-{{expense.id}}" onkeypress="return restrictAlphabets(event), float_value(event,$(this))" required>
                                                                            </td>                                    
                                                                        </tr>
                                                                        <tr style="float: left;background-color: aliceblue;">
                                                                            <td style="border:0px; vertical-align: bottom;padding-right: 26px;">
                                                                                Payment Type
                                                                            </td>
                                                                            <td style="border:0px;">
                                                                                <select class="form-control" name="payment_type" id="payment_type-{{expense.id}}" style="width:200%;" required>
                                                                                    <option value="">None</option>
                                                                                    {% for type in payment_type %}
                                                                                    <option value="{{type.0}}">{{type.1}}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </td>                                    
                                                                        </tr>
                                                                        <tr style="float: left;background-color: aliceblue;">
                                                                            <td style="border:0px; vertical-align: bottom;padding-right: 43px;">
                                                                                Reference#
                                                                            </td>
                                                                            <td style="border:0px;">
                                                                                <input class="form-control" value="{{expense.exp_number}}" type="text" id="pay_reference-{{expense.id}}" name="pay_reference">
                                                                            </td>                                    
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                            <!-- right -->
                                                            <div class="col" style="padding-left: 0px;">
                                                                <table class="table-responsive" >
                                                                    <tbody style=" width: 100%; display: inline-table;">
                                                                        <tr style="float: left;background-color: aliceblue;">
                                                                            <td style="border:0px; vertical-align: bottom;padding-right: 27px;">
                                                                                Payment Date
                                                                            </td>
                                                                            <td style="border:0px;">
                                                                                <input class="form-control pay_date" type="text" name="pay_date" id="pay_date-{{expense.id}}" required>
                                                                            </td>                                    
                                                                        </tr>
                                                                        <tr style="float: left;background-color: aliceblue;">
                                                                            <td style="border:0px; vertical-align: bottom;padding-right: 66px;">
                                                                                Account
                                                                            </td>
                                                                            <td style="border:0px;">
                                                                                <select class="form-control" name="pay_account" id="pay_account-{{expense.id}}" style="width: 139%;" required>
                                                                                    <option value="">None</option>
                                                                                    {% for i in acc_ledger_assets %}
                                                                                    <option value="{{i.id}}">{{i.group_name}}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </td>                                    
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        <div class="row" style="margin-left: -7px;">
                                                            <label for="">Notes</label>
                                                        </div>
                                                        <div class="row" style="margin-left: -7px;">
                                                            <textarea rows="3" id="pay_notes-{{expense.id}}" name="pay_notes" style="width: 50%;"></textarea>
                                                        </div>
                                                        <div class="row" style="margin-left: -7px;margin-top: 12px;">
                                                            <div class="col-2" style="padding-left: 0px;">
                                                                <label for="" style="float: left;">Attachment</label>
                                                            </div>
                                                            <div class="col-5" style="margin-left: -5%;">
                                                                <input class="form-control" type="file" id="pay_file-{{expense.id}}" name="pay_file">
                                                                <font style="font-size:x-small;margin-left: -48%;color: black;">File Size Less Than: 20 MB </font>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <div style="float: right;">
                                                        <button class="btn mr-2 btn-sm" type="submit" onclick="return check_amount({{expense.id}})" style="align-content: left;margin-left:150px;background-color:#598ebb">Pay</button>
                                                        <button type="button" class="btn btn-sm" data-dismiss="modal" aria-label="Close">Cancel</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                    </td>
                                </tr>
                                
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- customize view -->
<div class="modal fade" id="CustomizeViewModel" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="background-color:#202940">
            <form method="post" style="margin:0px" action="{% url 'edit_tax_details_form' %}">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" style="color:#000000; font-weight:bold;">Customize List</h5>
                    <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button> -->
                </div>
                <div class="modal-body">
                    {% csrf_token %}
                    <h5 style="color: black;text-align: center;margin-bottom: 1%;">Drag and drop be column name you want to show or hide</h5>
                    <ol data-draggable="target" id="first">
                        <h4 style="text-decoration: underline;">Show Column</h4>
                        {% if customize.expense_vocher != 0 %}
                        <li data-draggable="item" id="customize_expense_vocher">Expense Vocher</li>
                        {% endif %}
                        {% if customize.expense_date != 0 %}
                        <li data-draggable="item" id="customize_expense_date">Expense Date</li>
                        {% endif %}
                        {% if customize.expense_vendor != 0 %}
                        <li data-draggable="item" id="customize_expense_vendor">Vendor</li>
                        {% endif %}
                        {% if customize.expense_payment != 0 %}
                        <li data-draggable="item" id="customize_expense_payment">Payment Date</li>
                        {% endif %}
                        {% if customize.expense_method != 0 %}
                        <li data-draggable="item" id="customize_expense_method">Payment Method</li>
                        {% endif %}
                        {% if customize.expense_amount != 0 %}
                        <li data-draggable="item" id="customize_expense_amount">Total Amount</li>
                        {% endif %}
                      </ol>
                      
                      <ol data-draggable="target" id="seconde">
                          <h4 style="text-decoration: underline;">Hide Column</h4>
                          {% if customize.expense_vocher == 0 %}
                          <li data-draggable="item" id="customize_expense_vocher">Expense Vocher</li>
                          {% endif %}
                          {% if customize.expense_date == 0 %}
                          <li data-draggable="item" id="customize_expense_date">Expense Date</li>
                          {% endif %}
                          {% if customize.expense_vendor == 0 %}
                          <li data-draggable="item" id="customize_expense_vendor">Vendor</li>
                          {% endif %}
                          {% if customize.expense_payment == 0 %}
                          <li data-draggable="item" id="customize_expense_payment">Payment Date</li>
                          {% endif %}
                          {% if customize.expense_method == 0 %}
                          <li data-draggable="item" id="customize_expense_method">Payment Method</li>
                          {% endif %}
                          {% if customize.expense_amount == 0 %}
                          <li data-draggable="item" id="customize_expense_amount">Total Amount</li>
                          {% endif %}
                      </ol>
                      
                      
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm " type="button" onclick="customize_view(6)" style="background-color: #598ebb;">apply</button>
                    <a class="btn btn-sm " href="{% url 'view_expenses'  %}" type="reset" style="background-color: #9095a2;">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- <script src="{% static 'custom_files/js/make_payment.js' %}"></script> -->

<script>
/*******************************************************************/
// CUSTOMIZE VIEW LIST
/*******************************************************************/
// $(document).ready(function(){
    csrf_token = '{{csrf_token}}';

/*******************************************************************/
// CUSTOMIZE VIEW LIST
/*******************************************************************/
// $(document).ready(function(){
 
    function customize_view(ids){
    $('#CustomizeViewModel').modal('hide')
    data = {}
    if(ids == 6){
        if($('#first #customize_expense_vocher').length){
            data['vocher'] = 1
        }else{
            data['vocher'] = 0
        }

        if($('#first #customize_expense_date').length){
            data['date'] = 1
        }else{
            data['date'] = 0
        }

        if($('#first #customize_expense_vendor').length){
            data['vendor'] = 1
        }else{
            data['vendor'] = 0
        }

        if($('#first #customize_expense_payment').length){
            data['payment'] = 1
        }else{
            data['payment'] = 0
        }

        if($('#first #customize_expense_method').length){
            data['method'] = 1
        }else{
            data['method'] = 0
        }

        if($('#first #customize_expense_amount').length){
            data['amount'] = 1
        }else{
            data['amount'] = 0
        }

    }
     $.ajax({
      url: '/customize_view/'+ids+'/',
      type: 'POST',
      data: {'data':JSON.stringify(data), 'csrfmiddlewaretoken':csrf_token},
      beforeSend: function(){
       // Show image container
       $('#customize_table').hide();
       $(".loader").show();
       
      },
      success: function(data){
        if(ids == 6){

            if(data['vocher'] == 1){
                $('.customize_vocher').show()
            }else{
                $('.customize_vocher').hide()
            }

            if(data['date'] == 1){
                $('.customize_date').show()
            }else{
                $('.customize_date').hide()
            }

            if(data['vendor'] == 1){
                $('.customize_vendor').show()
            }else{
                $('.customize_vendor').hide()
            }

            if(data['payment'] == 1){
                $('.customize_payment').show()
            }else{
                $('.customize_payment').hide()
            }
    
            if(data['method'] == 1){
                $('.customize_method').show()
            }else{
                $('.customize_method').hide()
            }
    
            if(data['amount'] == 1){
                $('.customize_amount').show()
            }else{
                $('.customize_amount').hide()
            }
        }
      },
      complete:function(data){
       // Hide image container
    //    $("#loader").hide();
        $(".loader").hide();
        $('#customize_table').show();
        
      }
     });
    
    };
//    });

// *************************************************//

(function()
{

    //exclude older browsers by the features we need them to support
    //and legacy opera explicitly so we don't waste time on a dead browser
    if
    (
        !document.querySelectorAll 
        || 
        !('draggable' in document.createElement('span')) 
        || 
        window.opera
    ) 
    { return; }
    
    //get the collection of draggable items and add their draggable attribute
    for(var 
        items = document.querySelectorAll('[data-draggable="item"]'), 
        len = items.length, 
        i = 0; i < len; i ++)
    {
        items[i].setAttribute('draggable', 'true');
    }

    //variable for storing the dragging item reference 
    //this will avoid the need to define any transfer data 
    //which means that the elements don't need to have IDs 
    var item = null;

    //dragstart event to initiate mouse dragging
    document.addEventListener('dragstart', function(e)
    {
        //set the item reference to this element
        item = e.target;
        
        //we don't need the transfer data, but we have to define something
        //otherwise the drop action won't work at all in firefox
        //most browsers support the proper mime-type syntax, eg. "text/plain"
        //but we have to use this incorrect syntax for the benefit of IE10+
        e.dataTransfer.setData('text', '');
    
    }, false);

    //dragover event to allow the drag by preventing its default
    //ie. the default action of an element is not to allow dragging 
    document.addEventListener('dragover', function(e)
    {
        var ids = $(item).parent().attr("id");
        var count = $('#'+ids+' li').length;
        if(ids == 'first'){
                if(count > 1){
                    if(item)
                    {
                        e.preventDefault();
                    }
            }
        }else if(ids == 'seconde'){
            
            if(item)
                {                    
                    e.preventDefault();
                }
        }
        
        
    
    }, false);  

    //drop event to allow the element to be dropped into valid targets
    document.addEventListener('drop', function(e)
    {
        //if this element is a drop target, move the item here 
        //then prevent default to allow the action (same as dragover)
        if(e.target.getAttribute('data-draggable') == 'target')
        {
            e.target.appendChild(item);
            
            e.preventDefault();
        }
    
    }, false);
    
    //dragend event to clean-up after drop or abort
    //which fires whether or not the drop target was valid
    document.addEventListener('dragend', function(e)
    {
        item = null;
    
    }, false);

})();   
</script>


<script type="text/javascript">
    $('.delete_expense').on('click', function(){
        if(confirm('You want to delete this expense?')){
            var expense_id = $(this).attr('id');
            url = "{% url 'delete_expense' 0 %}"
            window.location.href = url.replace('0',expense_id);
        }
    });

    if ($("#print_expense").val()){
        str = "{%url 'generate_pdf' 0 %}"
        url = str.replace("0", $("#print_expense").val());
        $('#link').attr('href', url);
        $('#link').find("span").trigger("click");
    }

</script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<script>
    csrf_token = '{{csrf_token}}';
$(document).ready( function () {
    $('#expense_view').DataTable({
        searching: false,
        dom:"<'row '<'col-12'tr>>"+ "<'row'<'col-6 leftplug'><'col-6'<'row'<'col-3 lengh'l><'col-5 information'i><'col-4 pagination'p>>>>", 
        language : {
        sLengthMenu: "_MENU_"
        },
        sStripeEven: '', 
        sStripeOdd: '',
        // bSort: false,
        "lengthMenu": [[10, 20, 50, 100], ["10 Records", "20 Records", "50 Records", "100 Records"]]
    });
    //add margin to the right and reset clear
$(".dataTables_length").css('clear', 'none');
// $(".dataTables_length").css('margin-left', '20px');

//reset clear and padding
$(".dataTables_info").css('clear', 'none');
$(".dataTables_info").css('padding', '0');
});

</script>
{% endblock %}
